import{e as u,_ as P,g as B,$ as J,o as r,c as s,b as o,N as g,W as w,A as x,F as f,l as y,H as h,a as T,Y as U,d as Y,w as L,i as D,z as le,a0 as re,a1 as z,U as C,j as A,m as K,T as ne,O as se,a2 as ae}from"./app.js";import ie from"./PaginationComponent.js";import{V as de}from"./vue-draggable-next.esm-bundler.js";const k=u([]),E=u([]);function N(){return{queryGroups:k,rules:E,addQueryGroup:n=>{k.value.push({id:n,rules:[],condition:""})},removeQueryGroup:n=>{k.value=k.value.filter(a=>a.id!==n)},addRule:(n,a)=>{k.value.filter(i=>{i.id===n&&i.rules.push({id:a,field:"",operator:"",value:"",condition:""})}),E.value.push(a)},removeRule:(n,a)=>{k.value.filter(i=>{i.id===n&&(i.rules=i.rules.filter(c=>c.id!==a))}),E.value=E.value.filter(i=>i!==a)},findGroup:n=>k.value.filter(i=>{if(i.id===n)return i}),getGroupRules:n=>k.value.filter(i=>{if(i.id===n)return i}),updateRuleFilter:(n,a,i)=>{k.value.filter(c=>{c.id===n&&c.rules.filter(b=>{b.id===a&&(b.condition=i.condition,b.field=i.field,b.operator=i.operator,b.value=i.value)})})}}}const ue={__name:"Rule",props:["fields","groupIndex","index","itemNumber","values"],setup(_,{expose:t}){t();const d=_,e=u({condition:"",field:"",operator:"",value:""}),m=u([]);B(()=>{e.value=d.values}),J(()=>{e.value=d.values});const{removeRule:v,updateRuleFilter:l}=N(),c={props:d,rule:e,valueArr:m,removeRule:v,updateRuleFilter:l,remove:(b,R)=>{v(b,R)},ruleUpdated:()=>{l(d.groupIndex,d.index,e.value)},updateBetween:()=>{e.value.value=m.value.join(","),console.log(m.value,e.value),l(d.groupIndex,d.index,e.value)},onMounted:B,onUpdated:J,ref:u,watch:L,get useQueryGroup(){return N}};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}},ce={class:"d-flex justify-content-between align-items-center border p-2"},pe={class:"d-flex align-items-center"},ve={class:"d-flex flex-column"},fe={class:"d-flex mt-1"},me=["value"];function ge(_,t,d,e,m,v){return r(),s("div",ce,[o("div",pe,[o("div",ve,[e.props.itemNumber>0?g((r(),s("select",{key:0,class:"form-select form-select-sm",style:{width:"80px","background-color":"#ddd"},"onUpdate:modelValue":t[0]||(t[0]=l=>e.rule.condition=l),onChange:e.ruleUpdated},t[7]||(t[7]=[o("option",{value:"AND"},"AND",-1),o("option",{value:"OR"},"OR",-1)]),544)),[[w,e.rule.condition]]):x("v-if",!0),o("div",fe,[g(o("select",{class:"form-select","onUpdate:modelValue":t[1]||(t[1]=l=>e.rule.field=l),onChange:e.ruleUpdated},[(r(!0),s(f,null,y(d.fields,(l,n)=>(r(),s("option",{key:n,value:l.key},h(l.text),9,me))),128))],544),[[w,e.rule.field]]),g(o("select",{class:"form-select","onUpdate:modelValue":t[2]||(t[2]=l=>e.rule.operator=l),onChange:e.ruleUpdated},t[8]||(t[8]=[T('<option value="EQUAL">is equal</option><option value="NOT_EQUAL">is not equal</option><option value="LIKE">like</option><option value="NOT_LIKE">not like</option><option value="IN">contains</option><option value="NOT_IN">does not contain</option><option value="GREATER_THAN">is greater than</option><option value="GREATER_THAN_OR_EQUAL">is greater than or equal</option><option value="LESS_THAN">is less than </option><option value="LESS_THAN_OR_EQUAL">is less than or equal</option><option value="IS_NULL">is empty</option><option value="IS_NOT_NULL">is not empty</option><option value="BETWEEN">between</option><option value="NOT_BETWEEN">not between</option>',14)]),544),[[w,e.rule.operator]]),e.rule.operator==="BETWEEN"||e.rule.operator==="NOT_BETWEEN"?(r(),s(f,{key:0},[g(o("input",{class:"form-control",type:"text","onUpdate:modelValue":t[3]||(t[3]=l=>e.valueArr[0]=l),onChange:e.updateBetween},null,544),[[U,e.valueArr[0]]]),g(o("input",{class:"form-control",type:"text","onUpdate:modelValue":t[4]||(t[4]=l=>e.valueArr[1]=l),onChange:e.updateBetween},null,544),[[U,e.valueArr[1]]])],64)):g((r(),s("input",{key:1,class:"form-control",type:"text","onUpdate:modelValue":t[5]||(t[5]=l=>e.rule.value=l),onChange:e.ruleUpdated},null,544)),[[U,e.rule.value]])])])]),o("button",{class:"btn btn-danger",onClick:t[6]||(t[6]=l=>e.remove(d.groupIndex,d.index))},t[9]||(t[9]=[o("i",{class:"fa-solid fa-trash"},null,-1),Y(" Remove ")]))])}const ye=P(ue,[["render",ge],["__file","D:/laragon/www/esa/esa-helper/resources/js/pages/reports/Rule.vue"]]),be={__name:"RuleGroup",props:["fields","index"],setup(_,{expose:t}){t();const d=_,{removeQueryGroup:e,addRule:m,queryGroups:v}=N(),l=D(()=>v.value.filter(c=>{if(c.id===d.index)return c})),a={props:d,removeQueryGroup:e,addRule:m,queryGroups:v,groups:l,onAddRule:()=>{m(d.index,`rule-${Math.random()}`)},computed:D,toRefs:re,Rule:ye,get useQueryGroup(){return N}};return Object.defineProperty(a,"__isScriptSetup",{enumerable:!1,value:!0}),a}},_e={class:"d-flex border p-2 flex-column"},xe={class:"d-flex justify-content-between"},ke={class:"d-flex flex-column flex-wrap mt-3"};function Re(_,t,d,e,m,v){return r(),s("div",_e,[o("div",xe,[o("div",{class:"d-flex align-items-center"},[o("button",{class:"btn btn-sm btn-primary",onClick:e.onAddRule},"Add Rule"),t[1]||(t[1]=o("p",{class:"text-info m-0 ps-3"},"Add rule to filter records.",-1))]),o("button",{class:"btn btn-danger",onClick:t[0]||(t[0]=l=>e.removeQueryGroup(d.index))},t[2]||(t[2]=[o("i",{class:"fa-solid fa-trash"},null,-1),Y(" Remove Group ")]))]),o("div",ke,[(r(!0),s(f,null,y(e.groups,(l,n)=>(r(),s(f,{key:n},[(r(!0),s(f,null,y(l.rules,(a,i)=>(r(),le(e.Rule,{key:i,fields:d.fields,"item-number":i,"group-index":d.index,index:a.id,values:a},null,8,["fields","item-number","group-index","index","values"]))),128))],64))),128))])])}const he=P(be,[["render",Re],["__file","D:/laragon/www/esa/esa-helper/resources/js/pages/reports/RuleGroup.vue"]]),we={__name:"Reports",setup(_,{expose:t}){t();const d=z(),{queryGroups:e,addQueryGroup:m}=N(),v=u(!1),l=u([]),n=u([]),a=u(""),i=u("/generate-report"),c=u(200),b=u(""),R=u(""),O=u({}),S=u({current_page:d.query.p||1,to:1,data:{}}),Q=u([]),j=u([]),I=`group-${Math.random()}`,q=u([]),V=u("");B(()=>{M(),H(),m(I)});const M=()=>{C.get("/get-dynamic-reports").then(p=>{l.value=p.data.data})},G=()=>{v.value=!0,C.get(i.value,{params:{fields:n.value,groupBy:a.value,limit:c.value,order:F.value,filter:JSON.stringify(e.value)}}).then(p=>{S.value=p.data.data.records,Q.value=p.data.data.filters,j.value=n.value,v.value=!1}).finally(()=>{v.value=!1})},H=()=>{C.get("/get-saved-reports").then(p=>{q.value=p.data.data})},X=p=>{R.value=R.value==""?"DESC":R.value=="DESC"?"ASC":"",b.value=R.value==""?"":p,G()},Z=p=>{if(!v.value){if(p===S.value.current_page)return;S.value.current_page=p,G()}},$=()=>{V.value!=""&&C.post("/save-report",{name:V.value,fields:{fields:n.value,groupBy:a.value,limit:c.value,order:F.value,filter:JSON.stringify(e.value)}}).then(p=>{console.log(p)})},F=D(()=>JSON.stringify({orderBy:b.value,orderDirection:R.value})),ee=p=>{console.log("selected report",O.value),console.log(JSON.parse(O.value.fields))},te=()=>{m(`group-${Math.random()}`)},oe=p=>{S.value.data.length&&G()};L(c,p=>{G()});const W={route:d,queryGroups:e,addQueryGroup:m,loading:v,fields:l,reportFields:n,groupBy:a,reportUrl:i,limit:c,orderBy:b,orderDirection:R,selectedReport:O,data:S,filters:Q,headers:j,defaultGroupId:I,reports:q,reportName:V,getReportColumns:M,genrateReport:G,getSavedReports:H,setOrder:X,changePage:Z,saveReport:$,order:F,saveReportChanged:ee,addGroup:te,log:oe,computed:D,onMounted:B,ref:u,watch:L,get axios(){return C},get useRoute(){return z},PaginationComponent:ie,RuleGroup:he,get useQueryGroup(){return N},get VueDraggableNext(){return de}};return Object.defineProperty(W,"__isScriptSetup",{enumerable:!1,value:!0}),W}},Ne={class:"container-fluid"},Se={class:"loader loader-fixed"},Ge={class:"border border-2 mb-3 rounded bg-light"},Ce={class:"mb-3 p-3"},Ae=["value"],Ee={class:"p-3"},Ue={class:"text-capitalize fw-bold mb-0"},Be=["value","id"],De=["for"],Oe={key:0,class:"p-3"},Ve={key:1,class:"p-3"},Fe={class:"row g-3 align-items-center"},Te={class:"col-auto"},Le=["value"],Pe={key:2,class:"p-3 d-flex flex-column"},Qe=["onUpdate:modelValue"],je={key:3,class:"p-3"},Ie={key:4,class:"p-3"},qe={class:"d-flex justify-content-between align-items-center"},Me={class:"input-group"},He={class:"card"},We={class:"card-body"},Je={class:"d-flex justify-content-end align-items-center mb-3"},ze={class:"d-flex justify-content-center align-items-center"},Ke={class:"mb-3"},Ye={class:"table table-striped table-sm"},Xe={class:"thead-dark"},Ze={class:"report-header"},$e={class:"input-group"},et={class:"me-3"},tt=["onClick"],ot={key:0,class:"fa fa-caret-down"},lt={key:1,class:"fa fa-caret-up"},rt={key:2,class:"fa fa-sort"};function nt(_,t,d,e,m,v){return r(),s("div",Ne,[A(ne,{name:"fade",persisted:""},{default:K(()=>[g(o("div",Se,"Loading...",512),[[se,e.loading]])]),_:1}),o("div",Ge,[t[14]||(t[14]=o("h2",null,"Report Builder",-1)),o("section",Ce,[g(o("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":t[0]||(t[0]=l=>e.selectedReport=l),onChange:t[1]||(t[1]=l=>e.saveReportChanged(l))},[t[7]||(t[7]=o("option",{selected:"",value:""},"Select saved report",-1)),(r(!0),s(f,null,y(e.reports,(l,n)=>(r(),s("option",{key:_.field,value:l},h(l.name),9,Ae))),128))],544),[[w,e.selectedReport]])]),o("section",Ee,[t[8]||(t[8]=o("div",{class:"p-3 bg-info bg-opacity-10 border border-info border-3 border-start-3 border-top-0 border-bottom-0",role:"alert"}," Select Fields to generate report ",-1)),(r(!0),s(f,null,y(e.fields,(l,n)=>(r(),s("div",{class:"list-group-item",key:l.name},[o("p",Ue,h(n),1),(r(!0),s(f,null,y(l.fields,(a,i)=>(r(),s("div",{key:i,class:"form-check form-check-inline"},[g(o("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":t[2]||(t[2]=c=>e.reportFields=c),value:a,id:a.key},null,8,Be),[[ae,e.reportFields]]),o("label",{class:"form-check-label",for:a.key},h(a.text),9,De)]))),128))]))),128))]),e.reportFields.length>0?(r(),s("section",Oe,[t[9]||(t[9]=o("div",{class:"d-flex align-items-center mb-1"},[o("p",{class:"text-capitalize fw-bold mb-0 me-3"},"Selected Fields"),o("small",{class:"fst-italic"},"Drag-Drop fields to arrange in order for a report")],-1)),A(e.VueDraggableNext,{class:"dragArea w-full d-flex",list:e.reportFields,onChange:e.log},{default:K(()=>[(r(!0),s(f,null,y(e.reportFields,l=>(r(),s("div",{class:"bg-secondary text-white text-center border-1 p-2 me-1",key:l.key},h(l.text),1))),128))]),_:1},8,["list"])])):x("v-if",!0),e.reportFields.length>0?(r(),s("section",Ve,[o("div",Fe,[t[11]||(t[11]=o("div",{class:"col-auto"},[o("label",{for:"inputPassword6",class:"col-form-label"},"GroupBy")],-1)),o("div",Te,[g(o("select",{"onUpdate:modelValue":t[3]||(t[3]=l=>e.groupBy=l),class:"form-select",placeholder:"Select Option"},[t[10]||(t[10]=o("option",{disabled:"",selected:""},"Select Field",-1)),(r(!0),s(f,null,y(e.reportFields,(l,n)=>(r(),s("option",{key:n,value:l.key},h(l.text),9,Le))),128))],512),[[w,e.groupBy]])]),t[12]||(t[12]=o("div",{class:"col-auto"},[o("span",{id:"passwordHelpInline",class:"form-text text-info"}," Select GroupBy Field to group the report by selected field, or leave it blank. ")],-1))])])):x("v-if",!0),e.reportFields.length>0?(r(),s("section",Pe,[o("div",{class:"d-flex align-items-center"},[o("button",{class:"btn btn-sm btn-primary",onClick:e.addGroup},"Add Group")]),(r(!0),s(f,null,y(e.queryGroups,(l,n)=>(r(),s(f,{key:n},[n!=0?g((r(),s("select",{key:0,class:"form-select form-select-sm",style:{width:"75px","background-color":"#b2cce5"},"onUpdate:modelValue":a=>e.queryGroups[n].condition=a},[...t[13]||(t[13]=[o("option",{value:"AND"},"AND",-1),o("option",{value:"OR"},"OR",-1)])],8,Qe)),[[w,e.queryGroups[n].condition]]):x("v-if",!0),A(e.RuleGroup,{fields:e.reportFields,index:l.id},null,8,["fields","index"])],64))),128))])):x("v-if",!0),e.reportFields.length>0?(r(),s("section",je,[o("button",{class:"btn btn-success",onClick:e.genrateReport},"Generate")])):x("v-if",!0),e.reportFields.length>0?(r(),s("section",Ie,[o("div",qe,[o("div",Me,[g(o("input",{type:"text",class:"form-control",placeholder:"Report Name","aria-label":"Report name","onUpdate:modelValue":t[4]||(t[4]=l=>e.reportName=l)},null,512),[[U,e.reportName]]),o("button",{class:"btn btn-primary",type:"button",onClick:e.saveReport},"Save Report")])])])):x("v-if",!0)]),o("section",He,[o("div",We,[o("div",Je,[o("div",ze,[t[16]||(t[16]=o("label",{class:"form-label m-0 me-2"},"PerPage:",-1)),g(o("select",{"onUpdate:modelValue":t[5]||(t[5]=l=>e.limit=l),class:"form-select",onChange:t[6]||(t[6]=l=>_.updatePageLimit())},t[15]||(t[15]=[T('<option value="10">Show 10</option><option value="20">Show 20</option><option value="50">Show 50</option><option value="100">Show 100</option><option value="200">Show 200</option><option value="9999999999">Show All</option>',6)]),544),[[w,e.limit]])]),t[17]||(t[17]=T('<div class="filter-button-group"><a title="Print the results" class="btn btn-primary waves-effect"><i class="fa-solid fa-print" aria-hidden="true"></i></a><a title="Download results as PDF" class="btn btn-primary waves-effect"><i class="fa-solid fa-file-pdf" aria-hidden="true"></i></a><a title="Download results as CSV" class="btn btn-primary waves-effect"><i class="fa-solid fa-file-csv" aria-hidden="true"></i></a></div>',1))]),o("div",Ke,[A(e.PaginationComponent,{class:"card-pagination",data:e.data,loading:e.loading,onChange:e.changePage},null,8,["data","loading"])]),o("table",Ye,[o("thead",Xe,[o("tr",Ze,[(r(!0),s(f,null,y(e.headers,(l,n)=>(r(),s("th",{key:n,scope:"col"},[o("div",$e,[o("span",et,h(l.text),1),o("span",{class:"input-group-text me-2",id:"basic-addon01",onClick:a=>e.setOrder(l.key)},[l.key==e.orderBy&&e.orderDirection=="DESC"?(r(),s("i",ot)):x("v-if",!0),l.key==e.orderBy&&e.orderDirection=="ASC"?(r(),s("i",lt)):x("v-if",!0),l.key!=e.orderBy?(r(),s("i",rt)):x("v-if",!0)],8,tt)])]))),128))])]),o("tbody",null,[(r(!0),s(f,null,y(e.data.data,(l,n)=>(r(),s("tr",{key:n},[(r(!0),s(f,null,y(l,(a,i)=>(r(),s("td",{key:i},h(a),1))),128))]))),128))])]),o("div",null,[A(e.PaginationComponent,{class:"card-pagination",data:e.data,loading:e.loading,onChange:e.changePage},null,8,["data","loading"])])])])])}const dt=P(we,[["render",nt],["__file","D:/laragon/www/esa/esa-helper/resources/js/pages/reports/Reports.vue"]]);export{dt as default};
