import{g as u,_ as V,i as B,$ as I,o as n,c as s,b as t,O as g,W as w,C as k,G as f,p as y,J as R,a as E,Y as O,d as H,w as D,k as U,B as Y,a0 as X,a1 as M,V as T,l as C,q as Z,T as $,P as ee,a2 as oe}from"./app.js";import te from"./PaginationComponent.js";const x=u([]),A=u([]);function G(){return{queryGroups:x,rules:A,addQueryGroup:r=>{x.value.push({id:r,rules:[],condition:""})},removeQueryGroup:r=>{x.value=x.value.filter(a=>a.id!==r)},addRule:(r,a)=>{x.value.filter(i=>{i.id===r&&i.rules.push({id:a,field:"",operator:"",value:"",condition:""})}),A.value.push(a)},removeRule:(r,a)=>{x.value.filter(i=>{i.id===r&&(i.rules=i.rules.filter(c=>c.id!==a))}),A.value=A.value.filter(i=>i!==a)},findGroup:r=>x.value.filter(i=>{if(i.id===r)return i}),getGroupRules:r=>x.value.filter(i=>{if(i.id===r)return i}),updateRuleFilter:(r,a,i)=>{x.value.filter(c=>{c.id===r&&c.rules.filter(m=>{m.id===a&&(m.condition=i.condition,m.field=i.field,m.operator=i.operator,m.value=i.value)})})}}}const le={__name:"Rule",props:["fields","groupIndex","index","itemNumber","values"],setup(b,{expose:o}){o();const d=b,e=u({condition:"",field:"",operator:"",value:""}),v=u([]);B(()=>{e.value=d.values}),I(()=>{e.value=d.values});const{removeRule:p,updateRuleFilter:l}=G(),c={props:d,rule:e,valueArr:v,removeRule:p,updateRuleFilter:l,remove:(m,h)=>{p(m,h)},ruleUpdated:()=>{l(d.groupIndex,d.index,e.value)},updateBetween:()=>{e.value.value=v.value.join(","),console.log(v.value,e.value),l(d.groupIndex,d.index,e.value)},onMounted:B,onUpdated:I,ref:u,watch:D,get useQueryGroup(){return G}};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}},re={class:"d-flex justify-content-between align-items-center border p-2"},ne={class:"d-flex align-items-center"},se={class:"d-flex flex-column"},ae={class:"d-flex mt-1"},ie=["value"];function de(b,o,d,e,v,p){return n(),s("div",re,[t("div",ne,[t("div",se,[e.props.itemNumber>0?g((n(),s("select",{key:0,class:"form-select form-select-sm",style:{width:"80px","background-color":"#ddd"},"onUpdate:modelValue":o[0]||(o[0]=l=>e.rule.condition=l),onChange:e.ruleUpdated},o[7]||(o[7]=[t("option",{value:"AND"},"AND",-1),t("option",{value:"OR"},"OR",-1)]),544)),[[w,e.rule.condition]]):k("v-if",!0),t("div",ae,[g(t("select",{class:"form-select","onUpdate:modelValue":o[1]||(o[1]=l=>e.rule.field=l),onChange:e.ruleUpdated},[(n(!0),s(f,null,y(d.fields,(l,r)=>(n(),s("option",{key:r,value:l.key},R(l.text),9,ie))),128))],544),[[w,e.rule.field]]),g(t("select",{class:"form-select","onUpdate:modelValue":o[2]||(o[2]=l=>e.rule.operator=l),onChange:e.ruleUpdated},o[8]||(o[8]=[E('<option value="EQUAL">is equal</option><option value="NOT_EQUAL">is not equal</option><option value="LIKE">like</option><option value="NOT_LIKE">not like</option><option value="IN">contains</option><option value="NOT_IN">does not contain</option><option value="GREATER_THAN">is greater than</option><option value="GREATER_THAN_OR_EQUAL">is greater than or equal</option><option value="LESS_THAN">is less than </option><option value="LESS_THAN_OR_EQUAL">is less than or equal</option><option value="IS_NULL">is empty</option><option value="IS_NOT_NULL">is not empty</option><option value="BETWEEN">between</option><option value="NOT_BETWEEN">not between</option>',14)]),544),[[w,e.rule.operator]]),e.rule.operator==="BETWEEN"||e.rule.operator==="NOT_BETWEEN"?(n(),s(f,{key:0},[g(t("input",{class:"form-control",type:"text","onUpdate:modelValue":o[3]||(o[3]=l=>e.valueArr[0]=l),onChange:e.updateBetween},null,544),[[O,e.valueArr[0]]]),g(t("input",{class:"form-control",type:"text","onUpdate:modelValue":o[4]||(o[4]=l=>e.valueArr[1]=l),onChange:e.updateBetween},null,544),[[O,e.valueArr[1]]])],64)):g((n(),s("input",{key:1,class:"form-control",type:"text","onUpdate:modelValue":o[5]||(o[5]=l=>e.rule.value=l),onChange:e.ruleUpdated},null,544)),[[O,e.rule.value]])])])]),t("button",{class:"btn btn-danger",onClick:o[6]||(o[6]=l=>e.remove(d.groupIndex,d.index))},o[9]||(o[9]=[t("i",{class:"fa-solid fa-trash"},null,-1),H(" Remove ")]))])}const ue=V(le,[["render",de],["__file","D:/laragon/www/esa/esa-helper/resources/js/pages/reports/Rule.vue"]]),ce={__name:"RuleGroup",props:["fields","index"],setup(b,{expose:o}){o();const d=b,{removeQueryGroup:e,addRule:v,queryGroups:p}=G(),l=U(()=>p.value.filter(c=>{if(c.id===d.index)return c})),a={props:d,removeQueryGroup:e,addRule:v,queryGroups:p,groups:l,onAddRule:()=>{v(d.index,`rule-${Math.random()}`)},computed:U,toRefs:X,Rule:ue,get useQueryGroup(){return G}};return Object.defineProperty(a,"__isScriptSetup",{enumerable:!1,value:!0}),a}},pe={class:"d-flex border p-2 flex-column"},ve={class:"d-flex justify-content-between"},fe={class:"d-flex flex-column flex-wrap mt-3"};function me(b,o,d,e,v,p){return n(),s("div",pe,[t("div",ve,[t("div",{class:"d-flex align-items-center"},[t("button",{class:"btn btn-sm btn-primary",onClick:e.onAddRule},"Add Rule"),o[1]||(o[1]=t("p",{class:"text-info m-0 ps-3"},"Add rule to filter records.",-1))]),t("button",{class:"btn btn-danger",onClick:o[0]||(o[0]=l=>e.removeQueryGroup(d.index))},o[2]||(o[2]=[t("i",{class:"fa-solid fa-trash"},null,-1),H(" Remove Group ")]))]),t("div",fe,[(n(!0),s(f,null,y(e.groups,(l,r)=>(n(),s(f,{key:r},[(n(!0),s(f,null,y(l.rules,(a,i)=>(n(),Y(e.Rule,{key:i,fields:d.fields,"item-number":i,"group-index":d.index,index:a.id,values:a},null,8,["fields","item-number","group-index","index","values"]))),128))],64))),128))])])}const ge=V(ce,[["render",me],["__file","D:/laragon/www/esa/esa-helper/resources/js/pages/reports/RuleGroup.vue"]]),_e={__name:"Reports",setup(b,{expose:o}){o();const d=M(),{queryGroups:e,addQueryGroup:v}=G(),p=u(!1),l=u([]),r=u([]),a=u(""),i=u("/generate-report"),c=u(200),m=u(""),h=u(""),S=u({current_page:d.query.p||1,to:1,data:{}}),F=u([]),P=u([]),W=u([]),L=`group-${Math.random()}`;B(()=>{Q(),v(L)});const Q=()=>{T.get("/get-dynamic-reports").then(_=>{l.value=_.data.data})},N=()=>{p.value=!0,T.get(i.value,{params:{fields:r.value,groupBy:a.value,limit:c.value,order:j.value,filter:JSON.stringify(e.value)}}).then(_=>{S.value=_.data.data.records,F.value=_.data.data.filters,P.value=r.value,p.value=!1}).finally(()=>{p.value=!1})},J=_=>{h.value=h.value==""?"DESC":h.value=="DESC"?"ASC":"",m.value=h.value==""?"":_,N()},K=_=>{if(!p.value){if(_===S.value.current_page)return;S.value.current_page=_,N()}},j=U(()=>JSON.stringify({orderBy:m.value,orderDirection:h.value})),z=()=>{v(`group-${Math.random()}`)};D(c,_=>{N()});const q={route:d,queryGroups:e,addQueryGroup:v,loading:p,fields:l,reportFields:r,groupBy:a,reportUrl:i,limit:c,orderBy:m,orderDirection:h,data:S,filters:F,headers:P,groupOperator:W,defaultGroupId:L,getReportColumns:Q,genrateReport:N,setOrder:J,changePage:K,order:j,addGroup:z,computed:U,onMounted:B,ref:u,watch:D,get axios(){return T},get useRoute(){return M},PaginationComponent:te,RuleGroup:ge,get useQueryGroup(){return G}};return Object.defineProperty(q,"__isScriptSetup",{enumerable:!1,value:!0}),q}},ye={class:"container-fluid"},be={class:"loader loader-fixed"},xe={class:"border border-2 mb-3 rounded bg-light"},ke={class:"p-3"},he={class:"text-capitalize fw-bold mb-0"},Re=["value","id"],we=["for"],Ge={key:0,class:"p-3"},Se={class:"row g-3 align-items-center"},Ne={class:"col-auto"},Ce=["value"],Ae={key:1,class:"p-3 d-flex flex-column"},Ee=["onUpdate:modelValue"],Be={key:2,class:"p-3"},Ue={key:3,class:"p-3"},Oe={class:"card"},Te={class:"card-body"},De={class:"d-flex justify-content-end align-items-center mb-3"},Ve={class:"d-flex justify-content-center align-items-center"},Fe={class:"mb-3"},Pe={class:"table table-striped table-sm"},Le={class:"thead-dark"},Qe={class:"report-header"},je={class:"input-group"},qe={class:"me-3"},Ie=["onClick"],Me={key:0,class:"fa fa-caret-down"},He={key:1,class:"fa fa-caret-up"},We={key:2,class:"fa fa-sort"};function Je(b,o,d,e,v,p){return n(),s("div",ye,[C($,{name:"fade",persisted:""},{default:Z(()=>[g(t("div",be,"Loading...",512),[[ee,e.loading]])]),_:1}),t("div",xe,[o[10]||(o[10]=E('<h2>Report Builder</h2><section class="mb-3 p-3"><select class="form-select" aria-label="Default select example"><option selected>Select saved report</option><option value="1">One</option><option value="2">Two</option><option value="3">Three</option></select></section>',2)),t("section",ke,[o[4]||(o[4]=t("div",{class:"p-3 bg-info bg-opacity-10 border border-info border-3 border-start-3 border-top-0 border-bottom-0",role:"alert"}," Select Fields to generate report ",-1)),(n(!0),s(f,null,y(e.fields,(l,r)=>(n(),s("div",{class:"list-group-item",key:l.name},[t("p",he,R(r),1),(n(!0),s(f,null,y(l.fields,(a,i)=>(n(),s("div",{key:i,class:"form-check form-check-inline"},[g(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[0]||(o[0]=c=>e.reportFields=c),value:a,id:a.key},null,8,Re),[[oe,e.reportFields]]),t("label",{class:"form-check-label",for:a.key},R(a.text),9,we)]))),128))]))),128))]),e.reportFields.length>0?(n(),s("section",Ge,[t("div",Se,[o[6]||(o[6]=t("div",{class:"col-auto"},[t("label",{for:"inputPassword6",class:"col-form-label"},"GroupBy")],-1)),t("div",Ne,[g(t("select",{"onUpdate:modelValue":o[1]||(o[1]=l=>e.groupBy=l),class:"form-select",placeholder:"Select Option"},[o[5]||(o[5]=t("option",{disabled:"",selected:""},"Select Field",-1)),(n(!0),s(f,null,y(e.reportFields,(l,r)=>(n(),s("option",{key:r,value:l.key},R(l.text),9,Ce))),128))],512),[[w,e.groupBy]])]),o[7]||(o[7]=t("div",{class:"col-auto"},[t("span",{id:"passwordHelpInline",class:"form-text text-info"}," Select GroupBy Field to group the report by selected field, or leave it blank. ")],-1))])])):k("v-if",!0),e.reportFields.length>0?(n(),s("section",Ae,[t("div",{class:"d-flex align-items-center"},[t("button",{class:"btn btn-sm btn-primary",onClick:e.addGroup},"Add Group")]),(n(!0),s(f,null,y(e.queryGroups,(l,r)=>(n(),s(f,{key:r},[r!=0?g((n(),s("select",{key:0,class:"form-select form-select-sm",style:{width:"75px","background-color":"#b2cce5"},"onUpdate:modelValue":a=>e.queryGroups[r].condition=a},[...o[8]||(o[8]=[t("option",{value:"AND"},"AND",-1),t("option",{value:"OR"},"OR",-1)])],8,Ee)),[[w,e.queryGroups[r].condition]]):k("v-if",!0),C(e.RuleGroup,{fields:e.reportFields,index:l.id},null,8,["fields","index"])],64))),128))])):k("v-if",!0),e.reportFields.length>0?(n(),s("section",Be,[t("button",{class:"btn btn-success",onClick:e.genrateReport},"Generate")])):k("v-if",!0),e.reportFields.length>0?(n(),s("section",Ue,o[9]||(o[9]=[t("div",{class:"d-flex justify-content-between align-items-center"},[t("div",{class:"input-group"},[t("input",{type:"text",class:"form-control",placeholder:"Report Name","aria-label":"Report name"}),t("button",{class:"btn btn-primary",type:"button"},"Save")])],-1)]))):k("v-if",!0)]),t("section",Oe,[t("div",Te,[t("div",De,[t("div",Ve,[o[12]||(o[12]=t("label",{class:"form-label m-0 me-2"},"PerPage:",-1)),g(t("select",{"onUpdate:modelValue":o[2]||(o[2]=l=>e.limit=l),class:"form-select",onChange:o[3]||(o[3]=l=>b.updatePageLimit())},o[11]||(o[11]=[E('<option value="10">Show 10</option><option value="20">Show 20</option><option value="50">Show 50</option><option value="100">Show 100</option><option value="200">Show 200</option><option value="9999999999">Show All</option>',6)]),544),[[w,e.limit]])]),o[13]||(o[13]=E('<div class="filter-button-group"><a title="Print the results" class="btn btn-primary waves-effect"><i class="fa-solid fa-print" aria-hidden="true"></i></a><a title="Download results as PDF" class="btn btn-primary waves-effect"><i class="fa-solid fa-file-pdf" aria-hidden="true"></i></a><a title="Download results as CSV" class="btn btn-primary waves-effect"><i class="fa-solid fa-file-csv" aria-hidden="true"></i></a></div>',1))]),t("div",Fe,[C(e.PaginationComponent,{class:"card-pagination",data:e.data,loading:e.loading,onChange:e.changePage},null,8,["data","loading"])]),t("table",Pe,[t("thead",Le,[t("tr",Qe,[(n(!0),s(f,null,y(e.headers,(l,r)=>(n(),s("th",{key:r,scope:"col"},[t("div",je,[t("span",qe,R(l.text),1),t("span",{class:"input-group-text me-2",id:"basic-addon01",onClick:a=>e.setOrder(l.key)},[l.key==e.orderBy&&e.orderDirection=="DESC"?(n(),s("i",Me)):k("v-if",!0),l.key==e.orderBy&&e.orderDirection=="ASC"?(n(),s("i",He)):k("v-if",!0),l.key!=e.orderBy?(n(),s("i",We)):k("v-if",!0)],8,Ie)])]))),128))])]),t("tbody",null,[(n(!0),s(f,null,y(e.data.data,(l,r)=>(n(),s("tr",{key:r},[(n(!0),s(f,null,y(l,(a,i)=>(n(),s("td",{key:i},R(a),1))),128))]))),128))])]),t("div",null,[C(e.PaginationComponent,{class:"card-pagination",data:e.data,loading:e.loading,onChange:e.changePage},null,8,["data","loading"])])])])])}const Ye=V(_e,[["render",Je],["__file","D:/laragon/www/esa/esa-helper/resources/js/pages/reports/Reports.vue"]]);export{Ye as default};
