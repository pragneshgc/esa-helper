import{e as c,g as X,$ as ie,o as l,c as s,b as e,N as g,V as A,A as R,F as m,l as k,H as C,a as F,X as T,d as Y,i as Z,v as D,z as de,U as V,w as pe,j as B,m as z,T as ve,a0 as ce,O as fe,a1 as me}from"./app.js";import K from"./PaginationComponent.js";import{V as ge}from"./vue-draggable-next.esm-bundler.js";const _=c([]),$=c([]);function q(){return{queryGroups:_,rules:$,addQueryGroup:a=>{_.value.push({id:a,rules:[],condition:""})},removeQueryGroup:a=>{_.value=_.value.filter(d=>d.id!==a)},addRule:(a,d)=>{_.value.filter(t=>{t.id===a&&t.rules.push({id:d,field:"",operator:"",value:"",condition:""})}),$.value.push(d)},removeRule:(a,d)=>{_.value.filter(t=>{t.id===a&&(t.rules=t.rules.filter(r=>r.id!==d))}),$.value=$.value.filter(t=>t!==d)},findGroup:a=>_.value.filter(t=>{if(t.id===a)return t}),getGroupRules:a=>_.value.filter(t=>{if(t.id===a)return t}),updateRuleFilter:(a,d,t)=>{_.value.filter(r=>{r.id===a&&r.rules.filter(p=>{p.id===d&&(p.condition=t.condition,p.field=t.field,p.operator=t.operator,p.value=t.value)})})},setQueryGroups:a=>{_.value=a}}}const be={class:"d-flex justify-content-between align-items-center border p-2"},ye={class:"d-flex align-items-center"},xe={class:"d-flex flex-column"},ke={class:"d-flex mt-1"},he=["value"],_e={__name:"Rule",props:["fields","groupIndex","index","itemNumber","values"],setup(h){const b=h,u=c({condition:"",field:"",operator:"",value:""}),y=c([]);X(()=>{u.value=b.values}),ie(()=>{u.value=b.values});const{removeRule:U,updateRuleFilter:x}=q(),E=(d,t)=>{U(d,t)},i=()=>{x(b.groupIndex,b.index,u.value)},a=()=>{u.value.value=y.value.join(","),console.log(y.value,u.value),x(b.groupIndex,b.index,u.value)};return(d,t)=>(l(),s("div",be,[e("div",ye,[e("div",xe,[b.itemNumber>0?g((l(),s("select",{key:0,class:"form-select form-select-sm",style:{width:"80px","background-color":"#ddd"},"onUpdate:modelValue":t[0]||(t[0]=r=>u.value.condition=r),onChange:i},t[7]||(t[7]=[e("option",{value:"AND"},"AND",-1),e("option",{value:"OR"},"OR",-1)]),544)),[[A,u.value.condition]]):R("",!0),e("div",ke,[g(e("select",{class:"form-select","onUpdate:modelValue":t[1]||(t[1]=r=>u.value.field=r),onChange:i},[(l(!0),s(m,null,k(h.fields,(r,p)=>(l(),s("option",{key:p,value:r.key},C(r.text),9,he))),128))],544),[[A,u.value.field]]),g(e("select",{class:"form-select","onUpdate:modelValue":t[2]||(t[2]=r=>u.value.operator=r),onChange:i},t[8]||(t[8]=[F('<option value="EQUAL">is equal</option><option value="NOT_EQUAL">is not equal</option><option value="LIKE">like</option><option value="NOT_LIKE">not like</option><option value="IN">contains</option><option value="NOT_IN">does not contain</option><option value="GREATER_THAN">is greater than</option><option value="GREATER_THAN_OR_EQUAL">is greater than or equal</option><option value="LESS_THAN">is less than </option><option value="LESS_THAN_OR_EQUAL">is less than or equal</option><option value="IS_NULL">is empty</option><option value="IS_NOT_NULL">is not empty</option><option value="BETWEEN">between</option><option value="NOT_BETWEEN">not between</option>',14)]),544),[[A,u.value.operator]]),u.value.operator==="BETWEEN"||u.value.operator==="NOT_BETWEEN"?(l(),s(m,{key:0},[g(e("input",{class:"form-control",type:"text","onUpdate:modelValue":t[3]||(t[3]=r=>y.value[0]=r),onChange:a},null,544),[[T,y.value[0]]]),g(e("input",{class:"form-control",type:"text","onUpdate:modelValue":t[4]||(t[4]=r=>y.value[1]=r),onChange:a},null,544),[[T,y.value[1]]])],64)):g((l(),s("input",{key:1,class:"form-control",type:"text","onUpdate:modelValue":t[5]||(t[5]=r=>u.value.value=r),onChange:i},null,544)),[[T,u.value.value]])])])]),e("button",{class:"btn btn-danger",onClick:t[6]||(t[6]=r=>E(h.groupIndex,h.index))},t[9]||(t[9]=[e("i",{class:"fa-solid fa-trash"},null,-1),Y(" Remove ")]))]))}},Re={class:"d-flex border p-2 flex-column"},Ne={class:"d-flex justify-content-between"},Se={class:"d-flex flex-column flex-wrap mt-3"},we={__name:"RuleGroup",props:["fields","index"],setup(h){const b=h,{removeQueryGroup:u,addRule:y,queryGroups:U}=q(),x=Z(()=>U.value.filter(a=>{if(a.id===b.index)return a})),E=()=>{y(b.index,`rule-${Math.random()}`)};return(i,a)=>(l(),s("div",Re,[e("div",Ne,[e("div",{class:"d-flex align-items-center"},[e("button",{class:"btn btn-sm btn-primary",onClick:E},"Add Rule"),a[1]||(a[1]=e("p",{class:"text-info m-0 ps-3"},"Add rule to filter records.",-1))]),e("button",{class:"btn btn-danger",onClick:a[0]||(a[0]=d=>D(u)(h.index))},a[2]||(a[2]=[e("i",{class:"fa-solid fa-trash"},null,-1),Y(" Remove Group ")]))]),e("div",Se,[(l(!0),s(m,null,k(x.value,(d,t)=>(l(),s(m,{key:t},[(l(!0),s(m,null,k(d.rules,(r,p)=>(l(),de(_e,{key:p,fields:h.fields,"item-number":p,"group-index":h.index,index:r.id,values:r},null,8,["fields","item-number","group-index","index","values"]))),128))],64))),128))])]))}},Ce={class:"container-fluid"},Ee={class:"loader loader-fixed"},Ge={class:"border border-2 mb-3 rounded bg-light"},Ae={class:"mb-3 p-3"},Ue=["value"],Ve={class:"p-3"},Oe={class:"text-capitalize fw-bold mb-0"},Be=["value","id"],De=["for"],Te={key:0,class:"p-3"},$e={key:1,class:"p-3"},Le={class:"row g-3 align-items-center"},Qe={class:"col-auto"},Ie=["value"],Fe={key:2,class:"p-3 d-flex flex-column"},qe=["onUpdate:modelValue"],je={key:3,class:"p-3"},Je={key:4,class:"p-3"},Me={class:"d-flex justify-content-between align-items-center"},Pe={key:0,class:"input-group"},He={key:1,class:"input-group"},We={class:"card"},ze={class:"card-body"},Ke={class:"d-flex justify-content-end align-items-center mb-3"},Xe={class:"d-flex justify-content-center align-items-center"},Ye={class:"mb-3"},Ze={class:"table table-striped table-sm"},et={class:"thead-dark"},tt={class:"report-header"},ot={class:"input-group"},lt={class:"me-3"},st=["onClick"],at={key:0,class:"fa fa-caret-down"},nt={key:1,class:"fa fa-caret-up"},rt={key:2,class:"fa fa-sort"},pt={__name:"Reports",setup(h){const b=ce(),{queryGroups:u,addQueryGroup:y,setQueryGroups:U}=q(),x=c(!1),E=c([]),i=c([]),a=c(""),d=c("/generate-report"),t=c(200),r=c(""),p=c(""),G=c({}),w=c({current_page:b.query.p||1,to:1,data:{}}),j=c([]),J=`group-${Math.random()}`,M=c([]),N=c(""),L=c(!1);X(()=>{P(),H(),y(J)});const P=()=>{V.get("/get-dynamic-reports").then(v=>{E.value=v.data.data})},O=()=>{x.value=!0,V.get(d.value,{params:{fields:i.value,groupBy:a.value,limit:t.value,order:Q.value,filter:JSON.stringify(u.value)}}).then(v=>{w.value=v.data.data.records,j.value=i.value,x.value=!1}).finally(()=>{x.value=!1})},H=()=>{V.get("/get-saved-reports").then(v=>{M.value=v.data.data})},ee=v=>{p.value=p.value==""?"DESC":p.value=="DESC"?"ASC":"",r.value=p.value==""?"":v,O()},W=v=>{if(!x.value){if(v===w.value.current_page)return;w.value.current_page=v,O()}},te=()=>{N.value!=""&&V.post("/save-report",{name:N.value,fields:{fields:i.value,groupBy:a.value,limit:t.value,order:Q.value,filter:JSON.stringify(u.value)}}).then(v=>{console.log(v)})},oe=()=>{V.delete(`/delete-report/${G.value.id}`).then(v=>{P(),H(),y(J)})},le=()=>{L.value=!1,N.value=""},se=()=>{V.patch(`/update-report/${G.value.id}`,{name:N.value,fields:{fields:i.value,groupBy:a.value,limit:t.value,order:Q.value,filter:JSON.stringify(u.value)}}).then(v=>{})},Q=Z(()=>JSON.stringify({orderBy:r.value,orderDirection:p.value})),ae=v=>{if(G.value!=""){let o=JSON.parse(G.value.fields),n=JSON.parse(o.order),f=JSON.parse(o.filter);t.value=o.limit,a.value=o.groupBy,r.value=n.orderBy,p.value=n.orderDirection,i.value=o.fields,N.value=G.value.name,U(f),L.value=!0}},ne=()=>{y(`group-${Math.random()}`)},re=v=>{w.value.data.length&&O()};return pe(t,v=>{w.value.data.length&&O()}),(v,o)=>(l(),s("div",Ce,[B(ve,{name:"fade"},{default:z(()=>[g(e("div",Ee,"Loading...",512),[[fe,x.value]])]),_:1}),e("div",Ge,[o[14]||(o[14]=e("h2",null,"Report Builder",-1)),e("section",Ae,[g(e("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":o[0]||(o[0]=n=>G.value=n),onChange:o[1]||(o[1]=n=>ae())},[o[7]||(o[7]=e("option",{selected:"",value:""},"Select saved report",-1)),(l(!0),s(m,null,k(M.value,(n,f)=>(l(),s("option",{key:v.field,value:n},C(n.name),9,Ue))),128))],544),[[A,G.value]])]),e("section",Ve,[o[8]||(o[8]=e("div",{class:"p-3 bg-info bg-opacity-10 border border-info border-3 border-start-3 border-top-0 border-bottom-0",role:"alert"}," Select Fields to generate report ",-1)),(l(!0),s(m,null,k(E.value,(n,f)=>(l(),s("div",{class:"list-group-item",key:n.name},[e("p",Oe,C(f),1),(l(!0),s(m,null,k(n.fields,(S,I)=>(l(),s("div",{key:I,class:"form-check form-check-inline"},[g(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[2]||(o[2]=ue=>i.value=ue),value:S,id:S.key},null,8,Be),[[me,i.value]]),e("label",{class:"form-check-label",for:S.key},C(S.text),9,De)]))),128))]))),128))]),i.value.length>0?(l(),s("section",Te,[o[9]||(o[9]=e("div",{class:"d-flex align-items-center mb-1"},[e("p",{class:"text-capitalize fw-bold mb-0 me-3"},"Selected Fields"),e("small",{class:"fst-italic"},"Drag-Drop fields to arrange in order for a report")],-1)),B(D(ge),{class:"dragArea w-full d-flex",list:i.value,onChange:re},{default:z(()=>[(l(!0),s(m,null,k(i.value,n=>(l(),s("div",{class:"bg-secondary text-white text-center border-1 p-2 me-1",key:n.key},C(n.text),1))),128))]),_:1},8,["list"])])):R("",!0),i.value.length>0?(l(),s("section",$e,[e("div",Le,[o[11]||(o[11]=e("div",{class:"col-auto"},[e("label",{for:"inputPassword6",class:"col-form-label"},"GroupBy")],-1)),e("div",Qe,[g(e("select",{"onUpdate:modelValue":o[3]||(o[3]=n=>a.value=n),class:"form-select",placeholder:"Select Option"},[o[10]||(o[10]=e("option",{disabled:"",selected:""},"Select Field",-1)),(l(!0),s(m,null,k(i.value,(n,f)=>(l(),s("option",{key:f,value:n.key},C(n.text),9,Ie))),128))],512),[[A,a.value]])]),o[12]||(o[12]=e("div",{class:"col-auto"},[e("span",{id:"passwordHelpInline",class:"form-text text-info"}," Select GroupBy Field to group the report by selected field, or leave it blank. ")],-1))])])):R("",!0),i.value.length>0?(l(),s("section",Fe,[e("div",{class:"d-flex align-items-center"},[e("button",{class:"btn btn-sm btn-primary",onClick:ne},"Add Group")]),(l(!0),s(m,null,k(D(u),(n,f)=>(l(),s(m,{key:f},[f!=0?g((l(),s("select",{key:0,class:"form-select form-select-sm",style:{width:"75px","background-color":"#b2cce5"},"onUpdate:modelValue":S=>D(u)[f].condition=S},o[13]||(o[13]=[e("option",{value:"AND"},"AND",-1),e("option",{value:"OR"},"OR",-1)]),8,qe)),[[A,D(u)[f].condition]]):R("",!0),B(we,{fields:i.value,index:n.id},null,8,["fields","index"])],64))),128))])):R("",!0),i.value.length>0?(l(),s("section",je,[e("button",{class:"btn btn-success",onClick:O},"Generate")])):R("",!0),i.value.length>0?(l(),s("section",Je,[e("div",Me,[L.value?(l(),s("div",He,[g(e("input",{type:"text",class:"form-control",placeholder:"Report Name","aria-label":"Report name","onUpdate:modelValue":o[5]||(o[5]=n=>N.value=n)},null,512),[[T,N.value]]),e("button",{class:"btn btn-primary",type:"button",onClick:le},"Save Report As"),e("button",{class:"btn btn-success",type:"button",onClick:se},"Update Report"),e("button",{class:"btn btn-danger",type:"button",onClick:oe},"Delete Report")])):(l(),s("div",Pe,[g(e("input",{type:"text",class:"form-control",placeholder:"Report Name","aria-label":"Report name","onUpdate:modelValue":o[4]||(o[4]=n=>N.value=n)},null,512),[[T,N.value]]),e("button",{class:"btn btn-primary",type:"button",onClick:te},"Save Report")]))])])):R("",!0)]),e("section",We,[e("div",ze,[e("div",Ke,[e("div",Xe,[o[16]||(o[16]=e("label",{class:"form-label m-0 me-2"},"PerPage:",-1)),g(e("select",{"onUpdate:modelValue":o[6]||(o[6]=n=>t.value=n),class:"form-select"},o[15]||(o[15]=[F('<option value="10">Show 10</option><option value="20">Show 20</option><option value="50">Show 50</option><option value="100">Show 100</option><option value="200">Show 200</option><option value="9999999999">Show All</option>',6)]),512),[[A,t.value]])]),o[17]||(o[17]=F('<div class="filter-button-group"><a title="Print the results" class="btn btn-primary waves-effect"><i class="fa-solid fa-print" aria-hidden="true"></i></a><a title="Download results as PDF" class="btn btn-primary waves-effect"><i class="fa-solid fa-file-pdf" aria-hidden="true"></i></a><a title="Download results as CSV" class="btn btn-primary waves-effect"><i class="fa-solid fa-file-csv" aria-hidden="true"></i></a></div>',1))]),e("div",Ye,[B(K,{class:"card-pagination",data:w.value,loading:x.value,onChange:W},null,8,["data","loading"])]),e("table",Ze,[e("thead",et,[e("tr",tt,[(l(!0),s(m,null,k(j.value,(n,f)=>(l(),s("th",{key:f,scope:"col"},[e("div",ot,[e("span",lt,C(n.text),1),e("span",{class:"input-group-text me-2",id:"basic-addon01",onClick:S=>ee(n.key)},[n.key==r.value&&p.value=="DESC"?(l(),s("i",at)):R("",!0),n.key==r.value&&p.value=="ASC"?(l(),s("i",nt)):R("",!0),n.key!=r.value?(l(),s("i",rt)):R("",!0)],8,st)])]))),128))])]),e("tbody",null,[(l(!0),s(m,null,k(w.value.data,(n,f)=>(l(),s("tr",{key:f},[(l(!0),s(m,null,k(n,(S,I)=>(l(),s("td",{key:I},C(S),1))),128))]))),128))])]),e("div",null,[B(K,{class:"card-pagination",data:w.value,loading:x.value,onChange:W},null,8,["data","loading"])])])])]))}};export{pt as default};
