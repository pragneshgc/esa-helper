import{g as u,_ as P,i as O,$ as M,o as n,c as s,b as t,O as g,W as w,C as h,G as f,p as y,J as R,a as B,Y as U,d as W,w as F,k as T,B as Z,a0 as $,a1 as H,V as C,l as A,q as ee,T as oe,P as te,a2 as le}from"./app.js";import re from"./PaginationComponent.js";const x=u([]),E=u([]);function S(){return{queryGroups:x,rules:E,addQueryGroup:r=>{x.value.push({id:r,rules:[],condition:""})},removeQueryGroup:r=>{x.value=x.value.filter(a=>a.id!==r)},addRule:(r,a)=>{x.value.filter(i=>{i.id===r&&i.rules.push({id:a,field:"",operator:"",value:"",condition:""})}),E.value.push(a)},removeRule:(r,a)=>{x.value.filter(i=>{i.id===r&&(i.rules=i.rules.filter(c=>c.id!==a))}),E.value=E.value.filter(i=>i!==a)},findGroup:r=>x.value.filter(i=>{if(i.id===r)return i}),getGroupRules:r=>x.value.filter(i=>{if(i.id===r)return i}),updateRuleFilter:(r,a,i)=>{x.value.filter(c=>{c.id===r&&c.rules.filter(_=>{_.id===a&&(_.condition=i.condition,_.field=i.field,_.operator=i.operator,_.value=i.value)})})}}}const ne={__name:"Rule",props:["fields","groupIndex","index","itemNumber","values"],setup(b,{expose:o}){o();const d=b,e=u({condition:"",field:"",operator:"",value:""}),v=u([]);O(()=>{e.value=d.values}),M(()=>{e.value=d.values});const{removeRule:p,updateRuleFilter:l}=S(),c={props:d,rule:e,valueArr:v,removeRule:p,updateRuleFilter:l,remove:(_,k)=>{p(_,k)},ruleUpdated:()=>{l(d.groupIndex,d.index,e.value)},updateBetween:()=>{e.value.value=v.value.join(","),console.log(v.value,e.value),l(d.groupIndex,d.index,e.value)},onMounted:O,onUpdated:M,ref:u,watch:F,get useQueryGroup(){return S}};return Object.defineProperty(c,"__isScriptSetup",{enumerable:!1,value:!0}),c}},se={class:"d-flex justify-content-between align-items-center border p-2"},ae={class:"d-flex align-items-center"},ie={class:"d-flex flex-column"},de={class:"d-flex mt-1"},ue=["value"];function ce(b,o,d,e,v,p){return n(),s("div",se,[t("div",ae,[t("div",ie,[e.props.itemNumber>0?g((n(),s("select",{key:0,class:"form-select form-select-sm",style:{width:"80px","background-color":"#ddd"},"onUpdate:modelValue":o[0]||(o[0]=l=>e.rule.condition=l),onChange:e.ruleUpdated},o[7]||(o[7]=[t("option",{value:"AND"},"AND",-1),t("option",{value:"OR"},"OR",-1)]),544)),[[w,e.rule.condition]]):h("v-if",!0),t("div",de,[g(t("select",{class:"form-select","onUpdate:modelValue":o[1]||(o[1]=l=>e.rule.field=l),onChange:e.ruleUpdated},[(n(!0),s(f,null,y(d.fields,(l,r)=>(n(),s("option",{key:r,value:l.key},R(l.text),9,ue))),128))],544),[[w,e.rule.field]]),g(t("select",{class:"form-select","onUpdate:modelValue":o[2]||(o[2]=l=>e.rule.operator=l),onChange:e.ruleUpdated},o[8]||(o[8]=[B('<option value="EQUAL">is equal</option><option value="NOT_EQUAL">is not equal</option><option value="LIKE">like</option><option value="NOT_LIKE">not like</option><option value="IN">contains</option><option value="NOT_IN">does not contain</option><option value="GREATER_THAN">is greater than</option><option value="GREATER_THAN_OR_EQUAL">is greater than or equal</option><option value="LESS_THAN">is less than </option><option value="LESS_THAN_OR_EQUAL">is less than or equal</option><option value="IS_NULL">is empty</option><option value="IS_NOT_NULL">is not empty</option><option value="BETWEEN">between</option><option value="NOT_BETWEEN">not between</option>',14)]),544),[[w,e.rule.operator]]),e.rule.operator==="BETWEEN"||e.rule.operator==="NOT_BETWEEN"?(n(),s(f,{key:0},[g(t("input",{class:"form-control",type:"text","onUpdate:modelValue":o[3]||(o[3]=l=>e.valueArr[0]=l),onChange:e.updateBetween},null,544),[[U,e.valueArr[0]]]),g(t("input",{class:"form-control",type:"text","onUpdate:modelValue":o[4]||(o[4]=l=>e.valueArr[1]=l),onChange:e.updateBetween},null,544),[[U,e.valueArr[1]]])],64)):g((n(),s("input",{key:1,class:"form-control",type:"text","onUpdate:modelValue":o[5]||(o[5]=l=>e.rule.value=l),onChange:e.ruleUpdated},null,544)),[[U,e.rule.value]])])])]),t("button",{class:"btn btn-danger",onClick:o[6]||(o[6]=l=>e.remove(d.groupIndex,d.index))},o[9]||(o[9]=[t("i",{class:"fa-solid fa-trash"},null,-1),W(" Remove ")]))])}const pe=P(ne,[["render",ce],["__file","D:/laragon/www/esa/esa-helper/resources/js/pages/reports/Rule.vue"]]),ve={__name:"RuleGroup",props:["fields","index"],setup(b,{expose:o}){o();const d=b,{removeQueryGroup:e,addRule:v,queryGroups:p}=S(),l=T(()=>p.value.filter(c=>{if(c.id===d.index)return c})),a={props:d,removeQueryGroup:e,addRule:v,queryGroups:p,groups:l,onAddRule:()=>{v(d.index,`rule-${Math.random()}`)},computed:T,toRefs:$,Rule:pe,get useQueryGroup(){return S}};return Object.defineProperty(a,"__isScriptSetup",{enumerable:!1,value:!0}),a}},fe={class:"d-flex border p-2 flex-column"},me={class:"d-flex justify-content-between"},ge={class:"d-flex flex-column flex-wrap mt-3"};function _e(b,o,d,e,v,p){return n(),s("div",fe,[t("div",me,[t("div",{class:"d-flex align-items-center"},[t("button",{class:"btn btn-sm btn-primary",onClick:e.onAddRule},"Add Rule"),o[1]||(o[1]=t("p",{class:"text-info m-0 ps-3"},"Add rule to filter records.",-1))]),t("button",{class:"btn btn-danger",onClick:o[0]||(o[0]=l=>e.removeQueryGroup(d.index))},o[2]||(o[2]=[t("i",{class:"fa-solid fa-trash"},null,-1),W(" Remove Group ")]))]),t("div",ge,[(n(!0),s(f,null,y(e.groups,(l,r)=>(n(),s(f,{key:r},[(n(!0),s(f,null,y(l.rules,(a,i)=>(n(),Z(e.Rule,{key:i,fields:d.fields,"item-number":i,"group-index":d.index,index:a.id,values:a},null,8,["fields","item-number","group-index","index","values"]))),128))],64))),128))])])}const ye=P(ve,[["render",_e],["__file","D:/laragon/www/esa/esa-helper/resources/js/pages/reports/RuleGroup.vue"]]),be={__name:"Reports",setup(b,{expose:o}){o();const d=H(),{queryGroups:e,addQueryGroup:v}=S(),p=u(!1),l=u([]),r=u([]),a=u(""),i=u("/generate-report"),c=u(200),_=u(""),k=u(""),G=u({current_page:d.query.p||1,to:1,data:{}}),L=u([]),Q=u([]),j=`group-${Math.random()}`,J=u([]),D=u("");O(()=>{q(),v(j)});const q=()=>{C.get("/get-dynamic-reports").then(m=>{l.value=m.data.data})},N=()=>{p.value=!0,C.get(i.value,{params:{fields:r.value,groupBy:a.value,limit:c.value,order:V.value,filter:JSON.stringify(e.value)}}).then(m=>{G.value=m.data.data.records,L.value=m.data.data.filters,Q.value=r.value,p.value=!1}).finally(()=>{p.value=!1})},K=m=>{k.value=k.value==""?"DESC":k.value=="DESC"?"ASC":"",_.value=k.value==""?"":m,N()},z=m=>{if(!p.value){if(m===G.value.current_page)return;G.value.current_page=m,N()}},Y=()=>{D.value!=""&&C.post("/save-report",{name:D.value,fields:{fields:r.value,groupBy:a.value,limit:c.value,order:V.value,filter:JSON.stringify(e.value)}}).then(m=>{console.log(m)})},V=T(()=>JSON.stringify({orderBy:_.value,orderDirection:k.value})),X=()=>{v(`group-${Math.random()}`)};F(c,m=>{N()});const I={route:d,queryGroups:e,addQueryGroup:v,loading:p,fields:l,reportFields:r,groupBy:a,reportUrl:i,limit:c,orderBy:_,orderDirection:k,data:G,filters:L,headers:Q,defaultGroupId:j,reports:J,reportName:D,getReportColumns:q,genrateReport:N,setOrder:K,changePage:z,saveReport:Y,order:V,addGroup:X,computed:T,onMounted:O,ref:u,watch:F,get axios(){return C},get useRoute(){return H},PaginationComponent:re,RuleGroup:ye,get useQueryGroup(){return S}};return Object.defineProperty(I,"__isScriptSetup",{enumerable:!1,value:!0}),I}},xe={class:"container-fluid"},he={class:"loader loader-fixed"},ke={class:"border border-2 mb-3 rounded bg-light"},Re={class:"p-3"},we={class:"text-capitalize fw-bold mb-0"},Se=["value","id"],Ge=["for"],Ne={key:0,class:"p-3"},Ce={class:"row g-3 align-items-center"},Ae={class:"col-auto"},Ee=["value"],Be={key:1,class:"p-3 d-flex flex-column"},Ue=["onUpdate:modelValue"],Oe={key:2,class:"p-3"},Te={key:3,class:"p-3"},De={class:"d-flex justify-content-between align-items-center"},Ve={class:"input-group"},Fe={class:"card"},Pe={class:"card-body"},Le={class:"d-flex justify-content-end align-items-center mb-3"},Qe={class:"d-flex justify-content-center align-items-center"},je={class:"mb-3"},qe={class:"table table-striped table-sm"},Ie={class:"thead-dark"},Me={class:"report-header"},He={class:"input-group"},We={class:"me-3"},Je=["onClick"],Ke={key:0,class:"fa fa-caret-down"},ze={key:1,class:"fa fa-caret-up"},Ye={key:2,class:"fa fa-sort"};function Xe(b,o,d,e,v,p){return n(),s("div",xe,[A(oe,{name:"fade",persisted:""},{default:ee(()=>[g(t("div",he,"Loading...",512),[[te,e.loading]])]),_:1}),t("div",ke,[o[10]||(o[10]=B('<h2>Report Builder</h2><section class="mb-3 p-3"><select class="form-select" aria-label="Default select example"><option selected>Select saved report</option><option value="1">One</option><option value="2">Two</option><option value="3">Three</option></select></section>',2)),t("section",Re,[o[5]||(o[5]=t("div",{class:"p-3 bg-info bg-opacity-10 border border-info border-3 border-start-3 border-top-0 border-bottom-0",role:"alert"}," Select Fields to generate report ",-1)),(n(!0),s(f,null,y(e.fields,(l,r)=>(n(),s("div",{class:"list-group-item",key:l.name},[t("p",we,R(r),1),(n(!0),s(f,null,y(l.fields,(a,i)=>(n(),s("div",{key:i,class:"form-check form-check-inline"},[g(t("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[0]||(o[0]=c=>e.reportFields=c),value:a,id:a.key},null,8,Se),[[le,e.reportFields]]),t("label",{class:"form-check-label",for:a.key},R(a.text),9,Ge)]))),128))]))),128))]),e.reportFields.length>0?(n(),s("section",Ne,[t("div",Ce,[o[7]||(o[7]=t("div",{class:"col-auto"},[t("label",{for:"inputPassword6",class:"col-form-label"},"GroupBy")],-1)),t("div",Ae,[g(t("select",{"onUpdate:modelValue":o[1]||(o[1]=l=>e.groupBy=l),class:"form-select",placeholder:"Select Option"},[o[6]||(o[6]=t("option",{disabled:"",selected:""},"Select Field",-1)),(n(!0),s(f,null,y(e.reportFields,(l,r)=>(n(),s("option",{key:r,value:l.key},R(l.text),9,Ee))),128))],512),[[w,e.groupBy]])]),o[8]||(o[8]=t("div",{class:"col-auto"},[t("span",{id:"passwordHelpInline",class:"form-text text-info"}," Select GroupBy Field to group the report by selected field, or leave it blank. ")],-1))])])):h("v-if",!0),e.reportFields.length>0?(n(),s("section",Be,[t("div",{class:"d-flex align-items-center"},[t("button",{class:"btn btn-sm btn-primary",onClick:e.addGroup},"Add Group")]),(n(!0),s(f,null,y(e.queryGroups,(l,r)=>(n(),s(f,{key:r},[r!=0?g((n(),s("select",{key:0,class:"form-select form-select-sm",style:{width:"75px","background-color":"#b2cce5"},"onUpdate:modelValue":a=>e.queryGroups[r].condition=a},[...o[9]||(o[9]=[t("option",{value:"AND"},"AND",-1),t("option",{value:"OR"},"OR",-1)])],8,Ue)),[[w,e.queryGroups[r].condition]]):h("v-if",!0),A(e.RuleGroup,{fields:e.reportFields,index:l.id},null,8,["fields","index"])],64))),128))])):h("v-if",!0),e.reportFields.length>0?(n(),s("section",Oe,[t("button",{class:"btn btn-success",onClick:e.genrateReport},"Generate")])):h("v-if",!0),e.reportFields.length>0?(n(),s("section",Te,[t("div",De,[t("div",Ve,[g(t("input",{type:"text",class:"form-control",placeholder:"Report Name","aria-label":"Report name","onUpdate:modelValue":o[2]||(o[2]=l=>e.reportName=l)},null,512),[[U,e.reportName]]),t("button",{class:"btn btn-primary",type:"button",onClick:e.saveReport},"Save Report")])])])):h("v-if",!0)]),t("section",Fe,[t("div",Pe,[t("div",Le,[t("div",Qe,[o[12]||(o[12]=t("label",{class:"form-label m-0 me-2"},"PerPage:",-1)),g(t("select",{"onUpdate:modelValue":o[3]||(o[3]=l=>e.limit=l),class:"form-select",onChange:o[4]||(o[4]=l=>b.updatePageLimit())},o[11]||(o[11]=[B('<option value="10">Show 10</option><option value="20">Show 20</option><option value="50">Show 50</option><option value="100">Show 100</option><option value="200">Show 200</option><option value="9999999999">Show All</option>',6)]),544),[[w,e.limit]])]),o[13]||(o[13]=B('<div class="filter-button-group"><a title="Print the results" class="btn btn-primary waves-effect"><i class="fa-solid fa-print" aria-hidden="true"></i></a><a title="Download results as PDF" class="btn btn-primary waves-effect"><i class="fa-solid fa-file-pdf" aria-hidden="true"></i></a><a title="Download results as CSV" class="btn btn-primary waves-effect"><i class="fa-solid fa-file-csv" aria-hidden="true"></i></a></div>',1))]),t("div",je,[A(e.PaginationComponent,{class:"card-pagination",data:e.data,loading:e.loading,onChange:e.changePage},null,8,["data","loading"])]),t("table",qe,[t("thead",Ie,[t("tr",Me,[(n(!0),s(f,null,y(e.headers,(l,r)=>(n(),s("th",{key:r,scope:"col"},[t("div",He,[t("span",We,R(l.text),1),t("span",{class:"input-group-text me-2",id:"basic-addon01",onClick:a=>e.setOrder(l.key)},[l.key==e.orderBy&&e.orderDirection=="DESC"?(n(),s("i",Ke)):h("v-if",!0),l.key==e.orderBy&&e.orderDirection=="ASC"?(n(),s("i",ze)):h("v-if",!0),l.key!=e.orderBy?(n(),s("i",Ye)):h("v-if",!0)],8,Je)])]))),128))])]),t("tbody",null,[(n(!0),s(f,null,y(e.data.data,(l,r)=>(n(),s("tr",{key:r},[(n(!0),s(f,null,y(l,(a,i)=>(n(),s("td",{key:i},R(a),1))),128))]))),128))])]),t("div",null,[A(e.PaginationComponent,{class:"card-pagination",data:e.data,loading:e.loading,onChange:e.changePage},null,8,["data","loading"])])])])])}const eo=P(be,[["render",Xe],["__file","D:/laragon/www/esa/esa-helper/resources/js/pages/reports/Reports.vue"]]);export{eo as default};
