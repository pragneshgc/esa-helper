import{n as c,p as Z,q as pe,o as l,c as a,b as e,h as y,v as C,j as _,F as m,r as k,t as T,a as Q,k as M,s as O,u as w,d as ee,x as te,f as D,y as ve,g as B,w as X,T as ce,z as fe,m as me,A as ye}from"./app.js";import Y from"./PaginationComponent.js";import{G as $,V as be}from"./vue-datepicker.js";import"./_plugin-vue_export-helper.js";const R=c([]),H=c([]);function F(){return{queryGroups:R,rules:H,addQueryGroup:r=>{R.value.push({id:r,rules:[],condition:""})},removeQueryGroup:r=>{R.value=R.value.filter(d=>d.id!==r)},addRule:(r,d)=>{R.value.filter(t=>{t.id===r&&t.rules.push({id:d,field:"",operator:"",value:"",condition:""})}),H.value.push(d)},removeRule:(r,d)=>{R.value.filter(t=>{t.id===r&&(t.rules=t.rules.filter(n=>n.id!==d))}),H.value=H.value.filter(t=>t!==d)},findGroup:r=>R.value.filter(t=>{if(t.id===r)return t}),getGroupRules:r=>R.value.filter(t=>{if(t.id===r)return t}),updateRuleFilter:(r,d,t)=>{R.value.filter(n=>{n.id===r&&n.rules.filter(p=>{p.id===d&&(p.condition=t.condition,p.field=t.field,p.operator=t.operator,p.value=t.value)})})},setQueryGroups:r=>{R.value=r}}}const ge={class:"d-flex justify-content-between align-items-center border p-2"},xe={class:"d-flex align-items-center"},ke={class:"d-flex flex-column"},Ee={class:"d-flex mt-1"},Re=["value"],_e={__name:"Rule",props:["fields","groupIndex","index","itemNumber","values"],setup(E){const b=E,s=c({condition:"",field:"",operator:"",value:""}),g=c([]);Z(()=>{s.value=b.values}),pe(()=>{s.value=b.values});const{removeRule:G,updateRuleFilter:x}=F(),A=(d,t)=>{G(d,t)},i=()=>{x(b.groupIndex,b.index,s.value)},r=()=>{s.value.value=g.value.join(","),console.log(g.value,s.value),x(b.groupIndex,b.index,s.value)};return(d,t)=>(l(),a("div",ge,[e("div",xe,[e("div",ke,[b.itemNumber>0?y((l(),a("select",{key:0,class:"form-select form-select-sm",style:{width:"80px","background-color":"#ddd"},"onUpdate:modelValue":t[0]||(t[0]=n=>s.value.condition=n),onChange:i},t[11]||(t[11]=[e("option",{value:"AND"},"AND",-1),e("option",{value:"OR"},"OR",-1)]),544)),[[C,s.value.condition]]):_("",!0),e("div",Ee,[y(e("select",{class:"form-select","onUpdate:modelValue":t[1]||(t[1]=n=>s.value.field=n),onChange:i},[(l(!0),a(m,null,k(E.fields,(n,p)=>(l(),a("option",{key:p,value:n.key},T(n.text),9,Re))),128))],544),[[C,s.value.field]]),y(e("select",{class:"form-select","onUpdate:modelValue":t[2]||(t[2]=n=>s.value.operator=n),onChange:i},t[12]||(t[12]=[Q('<option value="EQUAL">is equal</option><option value="NOT_EQUAL">is not equal</option><option value="LIKE">like</option><option value="NOT_LIKE">not like</option><option value="IN">contains</option><option value="NOT_IN">does not contain</option><option value="GREATER_THAN">is greater than</option><option value="GREATER_THAN_OR_EQUAL">is greater than or equal</option><option value="LESS_THAN">is less than </option><option value="LESS_THAN_OR_EQUAL">is less than or equal</option><option value="IS_NULL">is empty</option><option value="IS_NOT_NULL">is not empty</option><option value="BETWEEN">between</option><option value="NOT_BETWEEN">not between</option><option value="WHERE_DATE">date</option><option value="WHERE_DATE_BETWEEN">date between</option><option value="WHERE_DATETIME">datetime</option><option value="WHERE_DATETIME_BETWEEN">datetime between</option>',18)]),544),[[C,s.value.operator]]),s.value.operator==="BETWEEN"||s.value.operator==="NOT_BETWEEN"?(l(),a(m,{key:0},[y(e("input",{class:"form-control",type:"text","onUpdate:modelValue":t[3]||(t[3]=n=>g.value[0]=n),onChange:r},null,544),[[M,g.value[0]]]),y(e("input",{class:"form-control",type:"text","onUpdate:modelValue":t[4]||(t[4]=n=>g.value[1]=n),onChange:r},null,544),[[M,g.value[1]]])],64)):s.value.operator==="WHERE_DATE"?(l(),O(w($),{key:1,modelValue:s.value.value,"onUpdate:modelValue":t[5]||(t[5]=n=>s.value.value=n),"enable-time-picker":!1,format:"dd/MM/yyyy"},null,8,["modelValue"])):s.value.operator==="WHERE_DATE_BETWEEN"?(l(),O(w($),{key:2,modelValue:s.value.value,"onUpdate:modelValue":t[6]||(t[6]=n=>s.value.value=n),range:"","enable-time-picker":!1,format:"dd/MM/yyyy"},null,8,["modelValue"])):s.value.operator==="WHERE_DATETIME"?(l(),O(w($),{key:3,modelValue:s.value.value,"onUpdate:modelValue":t[7]||(t[7]=n=>s.value.value=n),format:"dd/MM/yyyy HH:mm"},null,8,["modelValue"])):s.value.operator==="WHERE_DATETIME_BETWEEN"?(l(),O(w($),{key:4,modelValue:s.value.value,"onUpdate:modelValue":t[8]||(t[8]=n=>s.value.value=n),range:"",format:"dd/MM/yyyy HH:mm"},null,8,["modelValue"])):y((l(),a("input",{key:5,class:"form-control",type:"text","onUpdate:modelValue":t[9]||(t[9]=n=>s.value.value=n),onChange:i},null,544)),[[M,s.value.value]])])])]),e("button",{class:"btn btn-danger",onClick:t[10]||(t[10]=n=>A(E.groupIndex,E.index))},t[13]||(t[13]=[e("i",{class:"fa-solid fa-trash"},null,-1),ee(" Remove ")]))]))}},he={class:"d-flex border p-2 flex-column"},Ne={class:"d-flex justify-content-between"},we={class:"d-flex flex-column flex-wrap mt-3"},Se={__name:"RuleGroup",props:["fields","index"],setup(E){const b=E,{removeQueryGroup:s,addRule:g,queryGroups:G}=F(),x=te(()=>G.value.filter(r=>{if(r.id===b.index)return r})),A=()=>{g(b.index,`rule-${Math.random()}`)};return(i,r)=>(l(),a("div",he,[e("div",Ne,[e("div",{class:"d-flex align-items-center"},[e("button",{class:"btn btn-sm btn-primary text-white",onClick:A},"Add Rule"),r[1]||(r[1]=e("p",{class:"text-info m-0 ps-3"},"Add rule to filter records.",-1))]),e("button",{class:"btn btn-danger",onClick:r[0]||(r[0]=d=>w(s)(E.index))},r[2]||(r[2]=[e("i",{class:"fa-solid fa-trash"},null,-1),ee(" Remove Group ")]))]),e("div",we,[(l(!0),a(m,null,k(x.value,(d,t)=>(l(),a(m,{key:t},[(l(!0),a(m,null,k(d.rules,(n,p)=>(l(),O(_e,{key:p,fields:E.fields,"item-number":p,"group-index":E.index,index:n.id,values:n},null,8,["fields","item-number","group-index","index","values"]))),128))],64))),128))])]))}},Te={class:"container-fluid"},Ae={class:"loader loader-fixed"},Ve={class:"border border-2 mb-3 rounded bg-light"},Ce={class:"mb-3 p-3"},Ge=["value"],De={class:"p-3"},Ue={class:"text-capitalize fw-bold mb-0"},Be=["value","id"],Oe=["for"],Me={key:0,class:"p-3"},$e={key:1,class:"p-3"},He={class:"row g-3 align-items-center"},Ie={class:"col-auto"},We=["value"],Le={key:2,class:"p-3 d-flex flex-column"},Qe=["onUpdate:modelValue"],Fe={key:3,class:"p-3"},qe={key:4,class:"p-3"},je={class:"d-flex justify-content-between align-items-center"},Je={key:0,class:"input-group"},Pe={key:1,class:"input-group"},ze={class:"card"},Ke={class:"card-body"},Xe={class:"d-flex justify-content-end align-items-center mb-3"},Ye={class:"d-flex justify-content-center align-items-center"},Ze={class:"mb-3"},et={class:"table table-striped table-sm"},tt={class:"thead-dark"},lt={class:"report-header"},ot={class:"input-group"},at={class:"me-3"},st=["onClick"],nt={key:0,class:"fa fa-caret-down"},rt={key:1,class:"fa fa-caret-up"},ut={key:2,class:"fa fa-sort"},ct={__name:"Reports",setup(E){const b=fe(),{queryGroups:s,addQueryGroup:g,setQueryGroups:G}=F(),x=c(!1),A=c([]),i=c([]),r=c(""),d=c("/generate-report"),t=c(200),n=c(""),p=c(""),V=c({}),S=c({current_page:b.query.p||1,to:1,data:{}}),q=c([]),j=`group-${Math.random()}`,J=c([]),h=c(""),I=c(!1);Z(()=>{P(),z(),g(j)});const P=()=>{D.get("/get-dynamic-reports").then(v=>{A.value=v.data.data})},U=()=>{x.value=!0,D.get(d.value,{params:{fields:i.value,groupBy:r.value,limit:t.value,order:W.value,filter:JSON.stringify(s.value)}}).then(v=>{S.value=v.data.data.records,q.value=i.value,x.value=!1}).finally(()=>{x.value=!1})},z=()=>{D.get("/get-saved-reports").then(v=>{J.value=v.data.data})},le=v=>{p.value=p.value==""?"DESC":p.value=="DESC"?"ASC":"",n.value=p.value==""?"":v,U()},K=v=>{if(!x.value){if(v===S.value.current_page)return;S.value.current_page=v,U()}},oe=()=>{h.value!=""&&D.post("/save-report",{name:h.value,fields:{fields:i.value,groupBy:r.value,limit:t.value,order:W.value,filter:JSON.stringify(s.value)}}).then(v=>{console.log(v)})},ae=()=>{D.delete(`/delete-report/${V.value.id}`).then(v=>{P(),z(),g(j)})},se=()=>{I.value=!1,h.value=""},ne=()=>{D.patch(`/update-report/${V.value.id}`,{name:h.value,fields:{fields:i.value,groupBy:r.value,limit:t.value,order:W.value,filter:JSON.stringify(s.value)}}).then(v=>{})},W=te(()=>JSON.stringify({orderBy:n.value,orderDirection:p.value})),re=v=>{if(V.value!=""){let o=JSON.parse(V.value.fields),u=JSON.parse(o.order),f=JSON.parse(o.filter);t.value=o.limit,r.value=o.groupBy,n.value=u.orderBy,p.value=u.orderDirection,i.value=o.fields,h.value=V.value.name,G(f),I.value=!0}},ue=()=>{g(`group-${Math.random()}`)},ie=v=>{S.value.data.length&&U()};return ve(t,v=>{S.value.data.length&&U()}),(v,o)=>(l(),a("div",Te,[B(ce,{name:"fade"},{default:X(()=>[y(e("div",Ae,"Loading...",512),[[me,x.value]])]),_:1}),e("div",Ve,[o[14]||(o[14]=e("h2",{class:"ms-3 mt-2"},"Report Builder",-1)),e("section",Ce,[y(e("select",{class:"form-select","aria-label":"Default select example","onUpdate:modelValue":o[0]||(o[0]=u=>V.value=u),onChange:o[1]||(o[1]=u=>re())},[o[7]||(o[7]=e("option",{selected:"",value:""},"Select saved report",-1)),(l(!0),a(m,null,k(J.value,(u,f)=>(l(),a("option",{key:v.field,value:u},T(u.name),9,Ge))),128))],544),[[C,V.value]])]),e("section",De,[o[8]||(o[8]=e("div",{class:"p-3 bg-info bg-opacity-10 border border-info border-3 border-start-3 border-top-0 border-bottom-0",role:"alert"}," Select Fields to generate report ",-1)),(l(!0),a(m,null,k(A.value,(u,f)=>(l(),a("div",{class:"list-group-item",key:u.name},[e("p",Ue,T(f),1),(l(!0),a(m,null,k(u.fields,(N,L)=>(l(),a("div",{key:L,class:"form-check form-check-inline"},[y(e("input",{class:"form-check-input",type:"checkbox","onUpdate:modelValue":o[2]||(o[2]=de=>i.value=de),value:N,id:N.key},null,8,Be),[[ye,i.value]]),e("label",{class:"form-check-label",for:N.key},T(N.text),9,Oe)]))),128))]))),128))]),i.value.length>0?(l(),a("section",Me,[o[9]||(o[9]=e("div",{class:"d-flex align-items-center mb-1"},[e("p",{class:"text-capitalize fw-bold mb-0 me-3"},"Selected Fields"),e("small",{class:"fst-italic"},"Drag-Drop fields to arrange in order for a report")],-1)),B(w(be),{class:"dragArea w-full d-flex",list:i.value,onChange:ie},{default:X(()=>[(l(!0),a(m,null,k(i.value,u=>(l(),a("div",{class:"bg-secondary text-white text-center border-1 p-2 me-1",key:u.key},T(u.text),1))),128))]),_:1},8,["list"])])):_("",!0),i.value.length>0?(l(),a("section",$e,[e("div",He,[o[11]||(o[11]=e("div",{class:"col-auto"},[e("label",{for:"inputPassword6",class:"col-form-label"},"GroupBy")],-1)),e("div",Ie,[y(e("select",{"onUpdate:modelValue":o[3]||(o[3]=u=>r.value=u),class:"form-select",placeholder:"Select Option"},[o[10]||(o[10]=e("option",{disabled:"",selected:""},"Select Field",-1)),(l(!0),a(m,null,k(i.value,(u,f)=>(l(),a("option",{key:f,value:u.key},T(u.text),9,We))),128))],512),[[C,r.value]])]),o[12]||(o[12]=e("div",{class:"col-auto"},[e("span",{id:"passwordHelpInline",class:"form-text text-info"}," Select GroupBy Field to group the report by selected field, or leave it blank. ")],-1))])])):_("",!0),i.value.length>0?(l(),a("section",Le,[e("div",{class:"d-flex align-items-center"},[e("button",{class:"btn btn-sm btn-primary text-white",onClick:ue},"Add Group")]),(l(!0),a(m,null,k(w(s),(u,f)=>(l(),a(m,{key:f},[f!=0?y((l(),a("select",{key:0,class:"form-select form-select-sm",style:{width:"75px","background-color":"#b2cce5"},"onUpdate:modelValue":N=>w(s)[f].condition=N},o[13]||(o[13]=[e("option",{value:"AND"},"AND",-1),e("option",{value:"OR"},"OR",-1)]),8,Qe)),[[C,w(s)[f].condition]]):_("",!0),B(Se,{fields:i.value,index:u.id},null,8,["fields","index"])],64))),128))])):_("",!0),i.value.length>0?(l(),a("section",Fe,[e("button",{class:"btn btn-success",onClick:U},"Generate")])):_("",!0),i.value.length>0?(l(),a("section",qe,[e("div",je,[I.value?(l(),a("div",Pe,[y(e("input",{type:"text",class:"form-control",placeholder:"Report Name","aria-label":"Report name","onUpdate:modelValue":o[5]||(o[5]=u=>h.value=u)},null,512),[[M,h.value]]),e("button",{class:"btn btn-primary text-white",type:"button",onClick:se},"Save Report As"),e("button",{class:"btn btn-success",type:"button",onClick:ne},"Update Report"),e("button",{class:"btn btn-danger",type:"button",onClick:ae},"Delete Report")])):(l(),a("div",Je,[y(e("input",{type:"text",class:"form-control",placeholder:"Report Name","aria-label":"Report name","onUpdate:modelValue":o[4]||(o[4]=u=>h.value=u)},null,512),[[M,h.value]]),e("button",{class:"btn btn-primary text-white",type:"button",onClick:oe},"Save Report")]))])])):_("",!0)]),e("section",ze,[e("div",Ke,[e("div",Xe,[e("div",Ye,[o[16]||(o[16]=e("label",{class:"form-label m-0 me-2"},"PerPage:",-1)),y(e("select",{"onUpdate:modelValue":o[6]||(o[6]=u=>t.value=u),class:"form-select"},o[15]||(o[15]=[Q('<option value="10">Show 10</option><option value="20">Show 20</option><option value="50">Show 50</option><option value="100">Show 100</option><option value="200">Show 200</option><option value="9999999999">Show All</option>',6)]),512),[[C,t.value]])]),o[17]||(o[17]=Q('<div class="filter-button-group"><a title="Print the results" class="btn btn-outline-primary waves-effect"><i class="fa-solid fa-print" aria-hidden="true"></i></a><a title="Download results as PDF" class="btn btn-outline-primary waves-effect"><i class="fa-solid fa-file-pdf" aria-hidden="true"></i></a><a title="Download results as CSV" class="btn btn-outline-primary waves-effect"><i class="fa-solid fa-file-csv" aria-hidden="true"></i></a></div>',1))]),e("div",Ze,[B(Y,{class:"card-pagination",data:S.value,loading:x.value,onChange:K},null,8,["data","loading"])]),e("table",et,[e("thead",tt,[e("tr",lt,[(l(!0),a(m,null,k(q.value,(u,f)=>(l(),a("th",{key:f,scope:"col"},[e("div",ot,[e("span",at,T(u.text),1),e("span",{class:"input-group-text me-2",id:"basic-addon01",onClick:N=>le(u.key)},[u.key==n.value&&p.value=="DESC"?(l(),a("i",nt)):_("",!0),u.key==n.value&&p.value=="ASC"?(l(),a("i",rt)):_("",!0),u.key!=n.value?(l(),a("i",ut)):_("",!0)],8,st)])]))),128))])]),e("tbody",null,[(l(!0),a(m,null,k(S.value.data,(u,f)=>(l(),a("tr",{key:f},[(l(!0),a(m,null,k(u,(N,L)=>(l(),a("td",{key:L},T(N),1))),128))]))),128))])]),e("div",null,[B(Y,{class:"card-pagination",data:S.value,loading:x.value,onChange:K},null,8,["data","loading"])])])])]))}};export{ct as default};
